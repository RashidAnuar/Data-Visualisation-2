{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Unemployment Rate by State (1984 -2022)", "fontSize": 18},
  "autosize": { "type": "fit", "contains": "padding" },
    "width": "container",
  "height": 552,
  "data": { "url": "poverty_unemployment_by_state_year.csv" },

  "params":[
    {
      "name":"state_parameter",
      "value": null,
      "bind":{
        "input":"select",
        "name":"State Selection ",
        "options":[
          null,"Johor","Kedah","Kelantan","Kuala Lumpur","Labuan","Melaka",
          "Negeri Sembilan","Pahang","Perak","Perlis","Pulau Pinang",
          "Putrajaya","Sabah","Sarawak","Selangor","Terengganu"
        ],
        "labels":[
          "All States","Johor","Kedah","Kelantan","Kuala Lumpur","Labuan","Melaka",
          "Negeri Sembilan","Pahang","Perak","Perlis","Pulau Pinang",
          "Putrajaya","Sabah","Sarawak","Selangor","Terengganu"
        ]
      }
    }
  ],

  "transform": [
    {"calculate": "toNumber(datum['Unemployment rate'])", "as": "unemployment_rate"},
    {"calculate": "toNumber(datum['Year'])", "as": "year_num"},
    {"filter": "state_parameter == null || datum.State == state_parameter"},
    {"filter": "isValid(datum.unemployment_rate) && isValid(datum.year_num)"}
  ],

  "layer":[
    {
      "mark": {"type": "line", "point": true, "strokeWidth": 2, "opacity": 0.7, "interpolate": "linear", "tooltip": true, "aria": true, "cursor": "pointer"},
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
        "y": {"field": "unemployment_rate", "type": "quantitative", "title": "Unemployment rate (%)"},
        "color": {
          "field": "State",
          "type": "nominal",
          "title": "State",
          "scale": {
                "range":[
      "#00A6D6",  
      "#0072B2",  "#2E86C1", 
      "#3B5DC9",  
      "#5E60CE",  
      "#6B6ECF",  
      "#7A2DAF",  
      "#9467BD",  
      "#9B5DE5",  
      "#8E63FF",  
      "#C129A1",  
      "#E03FD8",  
      "#FFB000",  
      "#FF9E2C",  
      "#8C564B",  
      "#7F7F7F",  
      "#6C757D",  
      "#A9761A"   
    ]
            },
          "legend": {"orient": "right", "titleFontSize": 12, "labelFontSize": 10}
        },
        "tooltip": [
          {"field": "State"},
          {"field": "year_num", "title": "Year", "format": "d"},
          {"field": "unemployment_rate", "title": "Rate (%)", "format": ".2f"}
        ]
      }
    },

      
    {
      "transform": [
        {"window":[{"op":"rank","as":"rank"}], "sort":[{"field":"unemployment_rate","order":"descending"}]},
        {"filter": "datum.rank == 1"},
        {"calculate": "'Highest Unemployment rate: ' + format(datum.unemployment_rate, '.2f')", "as": "highest_rate"}
      ],
      "layer": [
        {
          "mark": {"type": "rule"},
          "encoding": {"x": {"field": "year_num"}}
        },
        {
          "mark": {"type": "text", "color": "black", "dy": -10, "fontWeight": "bold", "fontSize": 12},
          "encoding": {"text": {"field": "highest_rate"}}
        }
      ],
      "encoding": {
        "x": {"field": "year_num", "type": "quantitative"},
        "y": {"field": "unemployment_rate", "type": "quantitative"}
      }
    }
  ]
}
